package hadoop.yarn;

option java_package = "org.apache.hadoop.yarn.proto";

option java_outer_classname = "POSUMProtos";

import "yarn_protos.proto";

import "yarn_service_protos.proto";

import "yarn_server_common_service_protos.proto";

message EntityDBProto {
    required EntityDBTypeProto type = 1;
    optional string view = 2;
    enum EntityDBTypeProto {
        DB_MAIN = 0;
        DB_LOGS = 1;
        DB_SIMULATION = 2;
    }
}

enum EntityTypeProto {
    TYPE_APP = 0;
    TYPE_JOB = 1;
    TYPE_TASK = 2;
    TYPE_APP_HISTORY = 3;
    TYPE_JOB_HISTORY = 4;
    TYPE_TASK_HISTORY = 5;
    TYPE_HISTORY = 6;
}

message AppProfileProto {
    required string id = 1;
    optional int64 startTime = 2;
    optional int64 finishTime = 3;
    optional string user = 4;
    optional string name = 5;
    optional AppStateProto state = 6;
    optional AppStatusProto status = 7;
    optional AppTrackingUIProto trackingUI = 8;

    enum AppStateProto {
        STATE_NULL = 0;
        STATE_NEW = 1;
        STATE_NEW_SAVING = 2;
        STATE_SUBMITTED = 3;
        STATE_ACCEPTED = 4;
        STATE_RUNNING = 5;
        STATE_FINISHED = 6;
        STATE_FAILED = 7;
        STATE_KILLED = 8;
    }

    enum AppStatusProto {
        STATUS_NULL = 0;
        STATUS_UNDEFINED = 1;
        STATUS_SUCCEEDED = 2;
        STATUS_FAILED = 3;
        STATUS_KILLED = 4;
    }

    enum AppTrackingUIProto {
        UI_NULL = 0;
        UI_RM = 1;
        UI_AM = 2;
        UI_HISTORY = 3;
    }
}

message JobProfileProto {
    required string id = 1;
    optional string name = 2;
    optional string appId = 3;
    optional string user = 4;
    optional int32 totalMapTasks = 5;
    optional int32 totalReduceTasks = 6;
    optional int32 inputSplits = 7; // only from conf
    optional int64 inputBytes = 8; // only from conf
    optional int64 outputBytes = 9; // only in history
    optional int64 submitTime = 10; // only in history
    optional int64 startTime = 11;
    optional int64 finishTime = 12;
    optional JobStateProto state = 13;
    optional float mapProgress = 14;
    optional float reduceProgress = 15;
    optional int32 completedMaps = 16;
    optional int32 completedReduces = 17;
    optional bool uberized = 18;
    optional int32 avgMapDuration = 19;
    optional int32 avgReduceDuration = 20;
    optional int32 avgTaskDuration = 21;
    optional int32 avgShuffleDuration = 22;
    optional int32 avgMergeDuration = 23;

    enum JobStateProto {
        STATE_NULL = 0;
        STATE_NEW = 1;
        STATE_INITED = 2;
        STATE_RUNNING = 3;
        STATE_SUCCEEDED = 4;
        STATE_FAILED = 5;
        STATE_KILLED = 6;
        STATE_ERROR = 7;
    }
}

message TaskProfileProto {
    required string id = 1;
    optional string appId = 2;
    optional string jobId = 3;
    optional int64 inputBytes = 4;
    optional int64 inputRecords = 5;
    optional int64 outputBytes = 6;
    optional int64 outputRecords = 7;
    optional int64 expectedInputBytes = 8;
    optional int64 startTime = 9;
    optional int64 finishTime = 10;
    optional TaskTypeProto type = 11;
    optional float reportedProgress = 12;
    optional string successfulAttempt = 13;
    //    optional Counters counters = 14;

    enum TaskTypeProto {
        TYPE_NULL = 0;
        TYPE_MAP = 1;
        TYPE_REDUCE = 2;
    }
}

message HistoryProfileProto {
    required string id = 1;
    required EntityTypeProto type = 2;
    required int64 timestamp = 3;
    required string originalId = 4;
    required bytes original = 5;
}

message EntityPropertyProto {
    required PropertyTypeProto type = 1;
    required string name = 2;
    required string value = 3;

    enum PropertyTypeProto {
        PROPERTY_STRING = 0;
        PROPERTY_LONG = 1;
        PROPERTY_INT = 2;
        PROPERTY_BOOL = 3;
    }
}

message EntityByIdPayloadProto {
    required EntityDBProto entityDB = 1;
    required EntityTypeProto entityType = 2;
    required string id = 3;
}

message JobForAppPayloadProto {
    required EntityDBProto entityDB = 1;
    required string appId = 2;
}

message SingleEntityPayloadProto {
    required EntityTypeProto entityType = 1;
    optional bytes entity = 2;
}

message MultiEntityRequestProto {
    required EntityDBProto entityDB = 1;
    required EntityTypeProto entityType = 2;
    repeated EntityPropertyProto properties = 3;
}

message MultiEntityPayloadProto {
    required EntityTypeProto entityType = 1;
    repeated bytes entities = 2;
}

message SimpleRequestProto {
    required SimpleRequestTypeProto type = 1;
    optional bytes payload = 2;

    enum SimpleRequestTypeProto {
        REQ_PING = 0;
        REQ_CHANGE_POLICY = 1;
        REQ_ENTITY_BY_ID = 2;
        REQ_JOB_FOR_APP = 3;
        REQ_START = 4;
        REQ_LOG_POLICY_CHANGE = 5;
    }
}

message SimpleResponseProto {
    required bool successful = 1;
    optional string text = 2;
    required SimpleResponseTypeProto type = 3;
    optional bytes payload = 4;
    optional string exception = 5;

    enum SimpleResponseTypeProto {
        RESP_VOID = 0;
        RESP_SINGLE_ENTITY = 1;
        RESP_MULTI_ENTITY = 2;
    }
}

message SimulationResultProto {
    required string policyName = 1;
    optional CompoundScoreProto score = 2;
}

message CompoundScoreProto {
    optional double runtime = 1;
    optional double penalty = 2;
    optional double cost = 3;
}

message HandleSimResultRequestProto {
    repeated SimulationResultProto results = 1;
}

message RegistrationRequestProto {
    required POSUMProcessProto process = 1;
    required string connectAddress = 2;

    enum POSUMProcessProto {
        PROCESS_PM = 0;
        PROCESS_DM = 1;
        PROCESS_SIMULATOR = 2;
        PROCESS_SCHEDULER = 3;
    }
}